<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë°©ë‘ ê¸¸ë“œ | ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼</title>
  <meta name="description" content="ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼ ë¼ì‚¬ ì„œë²„ ë°©ë‘ ê¸¸ë“œ ê³µì§€ & ê²Œì„ ê¿€íŒ" />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    <style>
    :root{
      --bg:#fff0f6;

      --card:#ffffff;
      --card2:#fff6fb;

      --text:#3b2a30;
      --muted:#9a7c86;
      --line:rgba(243,154,178,.25);

      --brand:#f48fb1;
      --brand2:#f8bbd0;
      --warn:#ffb3a7;
      --danger:#ff7aa2;
      --ok:#8fcfb5;

      --shadow: 0 12px 30px rgba(244,143,177,.28);
      --radius: 22px;
      --radius2: 18px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Roboto, "Noto Sans KR",
                   "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% 0%, rgba(244,143,177,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(248,187,208,.20), transparent 55%),
        var(--bg);
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% 0%, rgba(122,162,255,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(155,255,214,.12), transparent 55%),
        radial-gradient(800px 500px at 50% 100%, rgba(255,204,102,.10), transparent 55%),
        var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:22px 18px 60px}
    .topbar{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(255,240,246,.92), rgba(255,240,246,.70));
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;gap:14px;align-items:center;justify-content:space-between}
    .brand{
      display:flex;gap:10px;align-items:center;
      font-weight:800;letter-spacing:.2px
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      padding:4px 10px;
      border:1px solid rgba(244,143,177,.25);
      border-radius:999px;
      background:#fff7fa;
    }
    nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .navbtn{
      font-size:13px;color:var(--muted);
      padding:8px 10px;border-radius:999px;
      border:1px solid transparent;
    }
    .navbtn:hover{color:var(--text);border-color:var(--line);background:#fff7fa}
    .hero{
      margin-top:18px;
      background: linear-gradient(135deg, #ffffff, #ffe9f1);
      border:1px solid rgba(244,143,177,.25);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding:26px 22px;
      display:grid;grid-template-columns: 1.2fr .8fr;gap:18px;
    }
    .hero h1{margin:0 0 8px;font-size:28px;line-height:1.15}
    .hero p{margin:0;color:var(--muted);line-height:1.55}
    .chips{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      font-size:12px;
      padding:7px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:#fff7fa;
      color:var(--muted)
    }
    .heroCard{
      border-radius: var(--radius2);
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      padding:14px 14px;
    }
    .kv{
      display:grid;gap:10px
    }
    .kvRow{
      display:flex;justify-content:space-between;gap:12px;
      padding:10px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.07);
      background:#fff7fa
    }
    .kvRow .k{color:var(--muted);font-size:12px}
    .kvRow .v{font-weight:700;font-size:13px}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      cursor:pointer;
      border:1px solid rgba(244,143,177,.35);
      background:#fff5f9;
      color:var(--text);
      padding:10px 12px;
      border-radius:16px;
      font-weight:700;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn:hover{filter:brightness(1.02)}
    .btn.primary{
      background: linear-gradient(135deg, #f8bbd0, #f48fb1);
      color:#ffffff;
      border:none;
      box-shadow: 0 6px 16px rgba(244,143,177,.35);
    }
    .grid{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:14px}
    section.card{
      border-radius: var(--radius);
      border:1px solid rgba(244,143,177,.25);
      background: linear-gradient(180deg, #ffffff, #fff3f8);
      box-shadow: var(--shadow);
      padding:18px 16px;
    }
    section.card h2{margin:0 0 10px;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin:0 0 14px;line-height:1.5}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0 12px}
    .pill{
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(244,143,177,.25);
      background:#fff3f8;
      user-select:none;
    }
    .pill.active{background: linear-gradient(135deg, #f8bbd0, #f48fb1); color:#ffffff; border:none}
    .input{
      width:100%;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(244,143,177,.25);
      background:#ffffff;
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    .list{display:grid;gap:10px}
    .item{
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      border-radius:18px;
      padding:12px 12px;
    }
    .itemTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .tag{
      font-size:11px;
      font-weight:800;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(244,143,177,.25);
      color:var(--muted);
      background:#fff0f6;
      white-space:nowrap;
    }
    .tag.important{background:#ffe4ec; color:#d94c7a; border-color:rgba(217,76,122,.25)}
    .tag.event{background:#fde2f0; color:#c94b78; border-color:rgba(201,75,120,.22)}
    .tag.ops{background:#ffeaf2; color:#b85a7c; border-color:rgba(184,90,124,.22)}
    .tag.tip{background:#e9fbf4; color:#4e8b73; border-color:rgba(78,139,115,.22)}
    .title{margin:0;font-weight:850;font-size:14px;line-height:1.35}
    .meta{margin-top:6px;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    details{border-top:1px dashed rgba(255,255,255,.10);margin-top:10px;padding-top:10px}
    details summary{cursor:pointer;color:var(--text);font-weight:800;font-size:13px;list-style:none}
    details summary::-webkit-details-marker{display:none}
    .content{color:var(--muted);font-size:13px;line-height:1.6;margin-top:10px}
    footer{
      margin-top:18px;color:var(--muted);font-size:12px;
      padding: 18px 10px 0;
      text-align:center;opacity:.9
    }
    .twoCol{
      display:grid;grid-template-columns:1fr 1fr;gap:10px
    }
    .miniCard{
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      border-radius:18px;
      padding:12px;
    }
    .miniCard h3{margin:0 0 6px;font-size:14px}
    .miniCard p{margin:0;color:var(--muted);font-size:13px;line-height:1.55}

/* ===== ëŸ¬ë¸”ë¦¬ ë§ˆë¬´ë¦¬ ===== */
section.card h2{
  display:flex;
  align-items:center;
  gap:6px;
  color:#d86b94;
}
.hero h1{color:#d86b94}
.emoji{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  filter:saturate(.75) brightness(1.08);
}

    .btn.ribbon{
      position:relative;
      padding-left:14px;
      padding-right:14px;
      border-radius:999px;
      box-shadow: 0 10px 22px rgba(244,143,177,.28);
    }
    .btn.ribbon::before,
    .btn.ribbon::after{
      content:"";
      position:absolute;
      top:50%;
      width:10px;height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.75);
      transform:translateY(-50%);
      filter:blur(.1px);
    }
    .btn.ribbon::before{left:10px}
    .btn.ribbon::after{right:10px}
    .btn.ribbon:hover{transform:translateY(-1px)}


    
    /* Mobile-safe wrapping for long text/URLs */
    .card p, .miniCard p, .content, .meta, .kvRow .v{
      overflow-wrap:anywhere;
      word-break:break-word;
    }
    a{
      overflow-wrap:anywhere;
      word-break:break-word;
    }


    
    /* Photo preview grid: 4 on desktop, 2 on mobile */
    .photoGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }


    /* Make photo board span full row on desktop to remove empty space */
    @media (min-width: 901px){
      #photos{grid-column: 1 / -1;}
    }
    @media (max-width: 900px){
      .hero{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      nav{justify-content:flex-start}
      .twoCol{grid-template-columns:1fr}
      .photoGrid{grid-template-columns: repeat(2, 1fr)}

    }
  
/* ===== í†µí•© í…ìŠ¤íŠ¸ ë§í¬ ë²„íŠ¼ (ê¿€íŒ/ì‚¬ì§„ "ë°”ë¡œê°€ê¸°") ===== */
.linkRow{
  display:flex;
  justify-content:flex-end;
  margin-top:12px;
}
.textLinkBtn{
  display:inline-block;
  font-size:13px;
  font-weight:750;
  color:var(--muted);
  padding:6px 2px;
  position:relative;
  text-decoration:none;
  transition: color .2s ease, transform .2s ease;
  overflow:hidden;
  -webkit-tap-highlight-color: transparent;
}
.textLinkBtn::after{
  content:"";
  position:absolute;
  left:0;
  bottom:-2px;
  width:0%;
  height:1px;
  background:var(--brand);
  transition: width .2s ease;
}
/* âœ¨ shimmer (hover/focus) */
.textLinkBtn::before{
  content:"";
  position:absolute;
  top:0;
  left:-130%;
  width:130%;
  height:100%;
  background: linear-gradient(120deg, transparent, rgba(255,255,255,.55), transparent);
  transition: left .45s ease;
  pointer-events:none;
}
.textLinkBtn:hover,
.textLinkBtn:focus-visible{
  color:var(--text);
  transform: translateX(2px);
}
.textLinkBtn:hover::after,
.textLinkBtn:focus-visible::after{
  width:100%;
}
.textLinkBtn:hover::before,
.textLinkBtn:focus-visible::before{
  left:130%;
}
/* ëª¨ë°”ì¼: ê°€ìš´ë° / ë°ìŠ¤í¬íƒ‘: ì˜¤ë¥¸ìª½ */
@media (max-width: 900px){
  .linkRow{justify-content:center;}
}

</style>
</head>
<body>
  <header class="topbar">
    <div class="inner">
      <div class="brand">
        <span style="display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:12px;border:1px solid var(--line);background:#fff7fa;font-weight:900;">â›µ</span>
        <div>
          <div>ë°©ë‘ ê¸¸ë“œ</div>
          <div class="badge">Mabinogi Mobile Â· ë¼ì‚¬ ì„œë²„</div>
        </div>
      </div>
      <nav>
        <a class="navbtn" href="#home">í™ˆ</a>
        <a class="navbtn" href="#notice">ê³µì§€ì‚¬í•­</a>
        <a class="navbtn" href="#tips">ê²Œì„ê¿€íŒ</a>
        <a class="navbtn" href="#about">ê¸¸ë“œì†Œê°œ</a>
        <a class="navbtn" href="#join">ê¸¸ë“œì•ˆë‚´</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="home">
    <section class="hero">
      <div>
        <h1>ê°ìì˜ ì†ë„ë¡œ, ì˜¤ë˜ í•¨ê»˜ ê°€ëŠ” ê¸¸ë“œ <span style="color:var(--brand)">ë°©ë‘</span></h1>
        <p>
          ì†ë„ë³´ë‹¤ ì§€ì†, ê²½ìŸë³´ë‹¤ í˜¸í¡. <br/>
          ê³µì§€ì™€ ê¿€íŒì€ ì—¬ê¸°ì„œ í•œ ë²ˆì— í™•ì¸í•˜ê³ , ê²Œì„ì€ í¸í•˜ê²Œ ì¦ê²¨ìš”.
        </p>
        <div class="chips">
          <span class="chip">ì¹œëª© & í˜‘ë ¥</span>
          <span class="chip">ë¼ì´íŠ¸ ~ ì¤‘ê°„ í•˜ë“œ</span>
          <span class="chip">ì •ë³´ ê³µìœ </span>
          <span class="chip">ì„œë¡œ ì¡´ì¤‘</span>
        </div>

        <div class="ctaRow">
          <a class="btn primary" href="#notice"><span class="emoji">ğŸ“¢</span> ê³µì§€ ë³´ëŸ¬ê°€ê¸°</a>
          <a class="btn" href="#tips"><span class="emoji">ğŸ®</span> ê¿€íŒ ë³´ëŸ¬ê°€ê¸°</a>
        </div>
      </div>

      <div class="heroCard">
        <div class="kv">
          <div class="kvRow">
            <div class="k">ì„œë²„</div>
            <div class="v">ë¼ì‚¬</div>
          </div>
          <div class="kvRow">
            <div class="k">ë¶„ìœ„ê¸°</div>
            <div class="v">ìœ ì¾Œ + ë§¤ë„ˆ</div>
          </div>
          <div class="kvRow">
            <div class="k">ìš´ì˜</div>
            <div class="v">ì—´ë¦° ì˜ê²¬ ìˆ˜ìš©</div>
          </div>
          <div class="kvRow">
            <div class="k">ê°€ì… ë¬¸ì˜</div>
            <div class="v">ê¸¸ë§ˆ 'êµ°ë¦¼' ê·“</div>
          </div>
        </div>
        <div class="ctaRow">
          <button class="btn" id="copyInvite">ê¸¸ë“œ í™ë³´ ë¬¸êµ¬ ë³µì‚¬</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <!-- ê³µì§€ì‚¬í•­ -->
      <section class="card" id="notice">
        <h2><span class="emoji">ğŸ“¢</span> ê³µì§€ì‚¬í•­</h2>
        <p class="sub">ìš´ì˜/ì´ë²¤íŠ¸/ì¤‘ìš” ê³µì§€ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>

        <div class="toolbar" id="noticeFilters">
          <span class="pill active" data-filter="all">ì „ì²´</span>
          <span class="pill" data-filter="ops">ìš´ì˜</span>
          <span class="pill" data-filter="event">ì´ë²¤íŠ¸</span>
          <span class="pill" data-filter="important">ì¤‘ìš”</span>
        </div>

        <div class="list" id="noticeList"></div>
      </section>

      <!-- ğŸ§  ê¿€íŒ ê²Œì‹œíŒ (ë…¸ì…˜ ì—°ë™) -->
      <section class="card" id="tips">
        <h2><span class="emoji">ğŸ®</span> ê¿€íŒ ê²Œì‹œíŒ</h2>
        <p class="sub"> ê²Œì„ì— ë„ì›€ë˜ëŠ” ê¿€íŒì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>

        <div id="tipState" class="sub" style="margin-top:10px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        <div class="list" id="tipPreview" style="margin-top:14px; display:none;"></div>

        <div class="linkRow">
          <a class="textLinkBtn" href="/tips.html">ê¿€íŒê²Œì‹œíŒ ë°”ë¡œê°€ê¸°</a>
        </div>
      </section>

      <!-- ğŸ“· ì‚¬ì§„ ê²Œì‹œíŒ (ë…¸ì…˜ ì—°ë™) -->
      <section class="card" id="photos">
        <h2><span class="emoji">ğŸ“·</span> ì‚¬ì§„ ê²Œì‹œíŒ</h2>
        <p class="sub">ê¸¸ë“œì›ë“¤ì˜ ìŠ¤í¬ë¦°ìƒ·/ì¶”ì–µì„ ëª¨ì•„ë´ìš” âœ¨</p>

        <div id="photoState" class="sub" style="margin-top:10px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        <div id="photoPreview" class="photoGrid" style="margin-top:14px; display:none;"></div>

        <div class="linkRow">
          <a class="textLinkBtn" href="/photos.html">ì‚¬ì§„ê²Œì‹œíŒ ë°”ë¡œê°€ê¸°</a>
        </div>
      </section>

    </div>

    <section class="card" id="about">
      <h2><span class="emoji">â›µ</span> ê¸¸ë“œ ì†Œê°œ</h2>
      <p class="sub">ë°©ë‘ì€ â€œì˜¤ë˜ ì¦ê¸¸ ì‚¬ëŒë“¤â€ì„ ìœ„í•œ ê¸¸ë“œì˜ˆìš”. ë§ ê±¸ê¸° ì–´ë ¤ìš´ ë¶„ìœ„ê¸° NO.</p>

      <div class="twoCol">
        <div class="miniCard">
          <h3>ìš°ë¦¬ê°€ ì§€í‚¤ëŠ” ë¶„ìœ„ê¸°</h3>
          <p>
            Â· ì„œë¡œì˜ ì†ë„ ì¡´ì¤‘<br/>
            Â· ê³¼í•œ í›ˆìˆ˜/ë¹„ë‚œ ê¸ˆì§€<br/>
            Â· ì •ë³´ëŠ” ë‚˜ëˆŒìˆ˜ë¡ ê°•í•´ì§
          </p>
        </div>
        <div class="miniCard">
          <h3>ì˜ ë§ëŠ” ë¶„ / ì•ˆ ë§ëŠ” ë¶„</h3>
          <p>
            âœ” ë¼ì´íŠ¸í•˜ê²Œ ì˜¤ë˜ í•˜ê³  ì‹¶ì€ ë¶„<br/>
            âœ” ê°™ì´ ì›ƒê³  í˜‘ë ¥í•˜ëŠ” ê±¸ ì¢‹ì•„í•˜ëŠ” ë¶„<br/><br/>
            âŒ ê²½ìŸÂ·ìˆœìœ„ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í° ë¶„<br/>
            âŒ ë¹„ë§¤ë„ˆÂ·ë¶€ì ì ˆí•œ ì–¸í–‰ì„ í•˜ì‹œëŠ” ë¶„<br/>
          </p>
        </div>
      </div>
    </section>

    <section class="card" id="join">
      <h2><span class="emoji">ğŸ¤</span> ê¸¸ë“œ ì•ˆë‚´</h2>
      <p class="sub">ë°©ë‘ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì†Œê°œë“œë ¤ìš” ! </p>

      <div class="twoCol">
        <div class="miniCard">
          <h3>ê°„ë‹¨ ê·œì¹™</h3>
          <p>
            Â· ë§¤ë„ˆ/ê¸°ë³¸ ì˜ˆì˜ í•„ìˆ˜<br/>
            Â· ë‹¨í†¡(í•„ìˆ˜)/ë””ì½”(ììœ ) ì°¸ì—¬<br/>
            Â· ì‚¬ì „ ê³µìœ ì—†ì´ 5ì¼ ì´ìƒ ë¯¸ì ‘ ì‹œ ì¶”ë°©
          </p>
        </div>
        <div class="miniCard">
          <h3>ì†Œí†µ ë°©ë²•</h3>
          <p>
            Â· ì˜¤í”ˆì±„íŒ… : https://open.kakao.com/o/g5QEodph<br/>
            Â· ë””ìŠ¤ì½”ë“œ : https://discord.gg/3Ju6HZ99kJ<br/>
            Â· ìš´ì˜ì§„ : ê¸¸ë§ˆ 'êµ°ë¦¼' & ë¶€ê¸¸ë§ˆ 'ì§êµ¬' 'ì½©íŒ¥' 'ë„ˆí¬ì§‘ë§‰ë‚´'
          </p>
        </div>
      </div>
    </section>

    


    <footer>
  <div style="font-weight:600; color:#c86a8a; margin-bottom:4px;">
    ê°ìì˜ ì†ë„ë¡œ, ì˜¤ë˜ í•¨ê»˜ ğŸŒ¸
  </div>
  <div style="font-size:12px;">
    Â© ë°©ë‘ ê¸¸ë“œ Â· Mabinogi Mobile Lasa Server<br/>
    This is a fan-made guild page Â· with love ğŸ’•<br/>
    ì œì‘/ìˆ˜ì • ë„ì›€: ë„ˆí¬ì§‘ë§‰ë‚´ with ì•Œë ‰ìŠ¤
  </div>
</footer>
  </main>

  
  <!-- Supabase (ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- photos.htmlê³¼ ê°™ì€ ì„¤ì • íŒŒì¼ì„ ë£¨íŠ¸ì— ë‘ë©´ ì¸ë±ìŠ¤ì—ì„œë„ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤ -->
  <script src="/supabase_config.js"></script>

  <script>
  /* =========================
     âœ… ë°©ë‘ ê¸¸ë“œ ì¸ë±ìŠ¤
     - ê³µì§€/ê¿€íŒ: Notion DB â†’ Netlify Functionsë¡œ ê°€ì ¸ì™€ì„œ "ì œëª© í´ë¦­ ì‹œ í¼ì¹¨"
     - ì‚¬ì§„: Supabase ì‚¬ì§„ê²Œì‹œíŒì—ì„œ ìµœê·¼ 6ì¥ ë¯¸ë¦¬ë³´ê¸°
  ========================= */

  // ---------- utils ----------
  const $ = (id) => document.getElementById(id);

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  function toParagraphs(text){
    const safe = escapeHtml(text||"");
    return safe.split(/\n+/).map(p=>`<p style="margin:0 0 10px">${p}</p>`).join("") || "";
  }

function renderImages(urls){
    const list = (urls || []).filter(Boolean);
    if(!list.length) return "";
    return `
      <div style="margin-top:10px; display:grid; gap:10px;">
        ${list.slice(0,6).map(u=>`
          <a href="${escapeHtml(u)}" target="_blank" rel="noopener" style="display:block">
            <img src="${escapeHtml(u)}" alt="image" style="width:100%; height:auto; display:block; border-radius:14px; border:1px solid rgba(244,143,177,.18); background:#fff7fa;">
          </a>
        `).join("")}
      </div>
    `;
  }

  function safe(obj, path, fallback="") {
    try {
      return path.split(".").reduce((a,k)=> (a && a[k]!==undefined) ? a[k] : undefined, obj) ?? fallback;
    } catch(e){ return fallback; }
  }

  
  function mapPage(p){
    const props = p.properties || {};

    // ---- title (ì œëª©/Title/ì´ë¦„ ë“±) ----
    const titleProp =
      props["ì œëª©"]?.title ?? props["Title"]?.title ?? props["ì´ë¦„"]?.title ?? props["Name"]?.title ?? [];
    const title = (titleProp || []).map(x=>x.plain_text).join("") || "(ì œëª© ì—†ìŒ)";

    // ---- date (ì‘ì„±ì¼/Date/ë‚ ì§œ ë“±) ----
    const date =
      props["ì‘ì„±ì¼"]?.date?.start
      || props["Date"]?.date?.start
      || props["ë‚ ì§œ"]?.date?.start
      || props["ì‘ì„± ë‚ ì§œ"]?.date?.start
      || "";

    // ---- icon (emoji only) ----
    const icon = p.icon && p.icon.type === "emoji" ? p.icon.emoji : "";

    // ---- category (ì¹´í…Œê³ ë¦¬/Category/ë¶„ë¥˜, select or multi_select first) ----
    const category =
      props["ì¹´í…Œê³ ë¦¬"]?.select?.name
      || props["Category"]?.select?.name
      || props["ë¶„ë¥˜"]?.select?.name
      || props["ì¹´í…Œê³ ë¦¬"]?.multi_select?.[0]?.name
      || props["Category"]?.multi_select?.[0]?.name
      || props["ë¶„ë¥˜"]?.multi_select?.[0]?.name
      || "";

    // ---- body (ë‚´ìš©/ë³¸ë¬¸/ì„¤ëª…/Description) ----
    const body =
      (props["ë‚´ìš©"]?.rich_text || props["ë³¸ë¬¸"]?.rich_text || props["ì„¤ëª…"]?.rich_text || props["Description"]?.rich_text || [])
        .map(x=>x.plain_text).join("")
      || "";

    // ---- tags (íƒœê·¸/Tags/í•´ì‹œíƒœê·¸, multi_select or select) ----
    const tagFromSelect =
      props["íƒœê·¸"]?.select?.name
      || props["Tags"]?.select?.name
      || props["í•´ì‹œíƒœê·¸"]?.select?.name
      || props["tag"]?.select?.name
      || "";

    const tagList =
      props["íƒœê·¸"]?.multi_select
      || props["Tags"]?.multi_select
      || props["í•´ì‹œíƒœê·¸"]?.multi_select
      || props["tag"]?.multi_select
      || [];

    const tags = [
      ...(tagFromSelect ? [tagFromSelect] : []),
      ...((tagList || []).map(x=>x.name).filter(Boolean))
    ];

    // ---- images (Notion DB property files OR page cover) ----
    // âš ï¸ Notion DB query ê²°ê³¼ë§Œìœ¼ë¡œëŠ” "ë³¸ë¬¸ì— ì‚½ì…ëœ ì´ë¯¸ì§€ ë¸”ë¡"ê¹Œì§€ ê°€ì ¸ì˜¤ì§€ ëª»í•´ìš”.
    // ëŒ€ì‹  DBì— files ì†ì„±(ì˜ˆ: 'ì´ë¯¸ì§€'/'Image'/'ì²¨ë¶€')ì„ ë§Œë“¤ì–´ ì˜¬ë ¤ë‘” ì´ë¯¸ì§€ URLì„ í‘œì‹œí•©ë‹ˆë‹¤.
    const fileProp =
      props["ì´ë¯¸ì§€"]?.files
      || props["Image"]?.files
      || props["ì²¨ë¶€"]?.files
      || props["Files"]?.files
      || [];

    const imagesFromProp = (fileProp || []).map(f=>{
      if(!f) return "";
      if(f.type === "external") return f.external?.url || "";
      if(f.type === "file") return f.file?.url || "";
      return "";
    }).filter(Boolean);

    const coverUrl = (p.cover?.type === "external") ? (p.cover.external?.url || "")
                    : (p.cover?.type === "file") ? (p.cover.file?.url || "")
                    : "";

    const images = [...imagesFromProp, ...(coverUrl ? [coverUrl] : [])];

    return { title, date, icon, category, body, tags, images };
  }


  async function fetchList(type){
    const res = await fetch(`/.netlify/functions/notion?type=${type}`, { cache: "no-store" });
    const data = await res.json().catch(()=> ({}));
    if(!res.ok){
      console.warn("Notion fetch error", type, data);
      throw new Error(data?.message || "fetch failed");
    }
    return (data.results || []).map(mapPage);
  }

  // ---------- ê³µì§€: ì œëª©ë§Œ ë³´ì´ë‹¤ê°€ í¼ì¹¨ ----------
  async function renderNotices(){
    const el = $("noticeList");
    if(!el) return;

    el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;

    try{
      const list = await fetchList("notice");

      // ğŸ“Œ ê³ ì • ìš°ì„ , ìµœì‹ ìˆœ
      list.sort((a,b)=>{
        const ap = a.icon === "ğŸ“Œ" ? 1 : 0;
        const bp = b.icon === "ğŸ“Œ" ? 1 : 0;
        if(ap !== bp) return bp - ap;
        return (b.date || "").localeCompare(a.date || "");
      });

      if(list.length === 0){
        el.innerHTML = `<div class="item"><p class="sub" style="margin:0">í‘œì‹œí•  ê³µì§€ê°€ ì—†ì–´ìš”.</p></div>`;
        return;
      }

      // ìƒë‹¨ í•„í„°(ì „ì²´/ìš´ì˜/ì´ë²¤íŠ¸/ì¤‘ìš”) ë™ì‘: categoryê°€ ê·¸ ë‹¨ì–´ë¥¼ í¬í•¨í•˜ë©´ ë§¤ì¹­
      const currentFilter = $("noticeFilters")?.querySelector(".pill.active")?.dataset.filter || "all";
      const filtered = list.filter(item=>{
        if(currentFilter === "all") return true;
        const cat = (item.category || "").toLowerCase();
        if(currentFilter === "ops") return cat.includes("ìš´ì˜");
        if(currentFilter === "event") return cat.includes("ì´ë²¤íŠ¸");
        if(currentFilter === "important") return cat.includes("ì¤‘ìš”") || item.icon === "ğŸ“Œ";
        return true;
      });

      if(filtered.length === 0){
        el.innerHTML = `<div class="item"><p class="sub" style="margin:0">í•´ë‹¹ í•„í„°ì˜ ê³µì§€ê°€ ì—†ì–´ìš”.</p></div>`;
        return;
      }

      el.innerHTML = filtered.slice(0,20).map(item=>{
        const badgePin = item.icon==="ğŸ“Œ" ? `<span class="tag important">ğŸ“Œ ê³ ì •</span>` : "";
        const cat = item.category ? `<span class="tag">${escapeHtml(item.category)}</span>` : "";
        const meta = `
          <div class="meta">
            ${badgePin}${cat}
            ${item.date ? `<span>ğŸ“… ${escapeHtml(item.date)}</span>` : ``}
          </div>
        `;

        // âœ… ë§í¬ ì—†ìŒ: ì œëª© í´ë¦­ â†’ í¼ì¹¨
        return `
          <div class="item">
            <div class="itemTop">
              <div style="width:100%">
                <p class="title">${escapeHtml(item.title)}</p>
                ${meta}
              </div>
            </div>
            <details>
              <summary>ë‚´ìš© ë³´ê¸°</summary>
              <div class="content">${renderImages(item.images)}${toParagraphs(item.body)}</div>
            </details>
          </div>
        `;
      }).join("");
    }catch(e){
      el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(e.message || String(e))}</p></div>`;
    }
  }

  
  // ---------- ê¿€íŒ ë¯¸ë¦¬ë³´ê¸°: Notionì—ì„œ ìµœì‹  3ê°œ ----------
  async function renderTipPreview(){
    const stateEl = $("tipState");
    const listEl  = $("tipPreview");
    if(!stateEl || !listEl) return;

    stateEl.style.display = "block";
    listEl.style.display = "none";
    stateEl.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

    try{
      const list = await fetchList("tips");
      list.sort((a,b)=> (b.date||"").localeCompare(a.date||""));

      if(!list.length){
        stateEl.textContent = "ì•„ì§ ë“±ë¡ëœ ê¿€íŒì´ ì—†ì–´ìš”. ì²« ê¿€íŒ ì˜¬ë ¤ì¤˜ìš” ğŸ’–";
        listEl.style.display = "none";
        return;
      }

      stateEl.style.display = "none";
      listEl.style.display = "grid";
      listEl.innerHTML = list.slice(0,3).map(item=>{
        const tags = (item.tags||[]).filter(Boolean);
        const mainBadges = (tags.length ? tags.slice(0,2) : (item.category ? [item.category] : []))
          .map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("");
        return `
          <div class="item">
            <div class="itemTop">
              <div style="width:100%">
                <p class="title">${escapeHtml(item.title)}</p>
                <div class="meta" style="margin-top:8px">
                  ${mainBadges}
                  ${item.date ? `<span>ğŸ“… ${escapeHtml(item.date)}</span>` : ``}
                </div>
              </div>
            </div>
            <details>
              <summary>ë‚´ìš© ë³´ê¸°</summary>
              <div class="content">${renderImages(item.images)}${toParagraphs(item.body)}</div>
            </details>
          </div>
        `;
      }).join("");
    }catch(e){
      stateEl.textContent = "ê¿€íŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + (e?.message || String(e));
      listEl.style.display = "none";
    }
  }


  // ---------- ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°: Supabase ì‚¬ì§„ê²Œì‹œíŒì—ì„œ ìµœê·¼ 6ì¥ ----------
  async function renderPhotoPreview(){
    const stateEl = $("photoState");
    const gridEl  = $("photoPreview");
    if(!stateEl || !gridEl) return;

    // supabase_config.js ëˆ„ë½ ì‹œ
    if(!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY || !window.supabase){
      stateEl.textContent = "ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •ì´ ì•„ì§ ì—†ì–´ìš”. (supabase_config.js í™•ì¸)";
      gridEl.style.display = "none";
      return;
    }

    const sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    const BUCKET = "bangrang-photos";
    const TABLE  = "photo_posts";

    stateEl.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    gridEl.style.display = "none";

    const { data, error } = await sb
      .from(TABLE)
      .select("id, image_path, caption, nickname, created_at, taken_on")
      .order("created_at", { ascending:false })
      .limit(4);

    if(error){
      stateEl.textContent = "ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + error.message;
      gridEl.style.display = "none";
      return;
    }

    if(!data || data.length === 0){
      stateEl.textContent = "ì•„ì§ ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ì–´ìš”. ì²« ì—…ë¡œë“œ í•´ì¤˜ìš” ğŸ’–";
      gridEl.style.display = "none";
      return;
    }

    stateEl.style.display = "none";
    gridEl.style.display = "grid";
    gridEl.innerHTML = data.map(row=>{
      const { data: pub } = sb.storage.from(BUCKET).getPublicUrl(row.image_path);
      const imgUrl = pub.publicUrl;
      const title = escapeHtml(row.caption || "ì‚¬ì§„");
      const who = escapeHtml(row.nickname || "ìµëª…");
      return `
        <a class="miniCard" href="/photos.html" style="padding:10px; border-radius:18px; overflow:hidden;">
          <div style="width:100%; aspect-ratio:1/1; border-radius:14px; overflow:hidden; border:1px solid rgba(244,143,177,.18); background:#fff7fa;">
            <img src="${imgUrl}" alt="${title}" style="width:100%; height:100%; object-fit:cover; display:block;">
          </div>
          <div style="margin-top:8px; font-weight:800; font-size:13px; line-height:1.25; color:var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${title}</div>
          <div style="margin-top:4px; font-size:12px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">ğŸ‘¤ ${who}</div>
        </a>
      `;
    }).join("");
  }

  // ---------- UI events ----------
  // ê³µì§€ í•„í„° í´ë¦­ â†’ ë‹¤ì‹œ ë Œë”
  const noticeFilters = $("noticeFilters");
  if(noticeFilters){
    noticeFilters.addEventListener("click", (e)=>{
      const pill = e.target.closest(".pill");
      if(!pill) return;
      [...noticeFilters.querySelectorAll(".pill")].forEach(p=>p.classList.remove("active"));
      pill.classList.add("active");
      renderNotices();
    });
  }

  // ì´ˆëŒ€ ë¬¸êµ¬ ë³µì‚¬ ë²„íŠ¼(ê¸°ì¡´ ìœ ì§€)
  const copyBtn = $("copyInvite");
  if(copyBtn){
    copyBtn.addEventListener("click", async ()=>{
      const text =
`[ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼] ë¼ì‚¬ ì„œë²„ 'ë°©ë‘' ê¸¸ë“œì—ì„œ í•¨ê»˜í•˜ì‹¤ ë¶„ì„ ì°¾ì•„ìš”!
- ë¼ì´íŠ¸~ì¤‘ê°„ í•˜ë“œ / ì¹œëª©&í˜‘ë ¥
- ë¬¸ì˜: ê¸¸ë§ˆ 'êµ°ë¦¼' ê·“`;
      try{
        await navigator.clipboard.writeText(text);
        alert("ì´ˆëŒ€ ë¬¸êµ¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”!");
      }catch(err){
        prompt("ë³µì‚¬ ê¶Œí•œì´ ì—†ì–´ì„œ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:", text);
      }
    });
  }

  // ---------- start ----------
  renderNotices();
  renderTipPreview();
  renderPhotoPreview();
  </script>

</body>
</html>
