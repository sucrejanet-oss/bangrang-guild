<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë°©ë‘ ê¸¸ë“œ | ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼</title>
  <meta name="description" content="ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼ ë¼ì‚¬ ì„œë²„ ë°©ë‘ ê¸¸ë“œ ê³µì§€ & ê²Œì„ ê¿€íŒ" />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    <style>
    :root{
      --bg:#fff0f6;

      --card:#ffffff;
      --card2:#fff6fb;

      --text:#3b2a30;
      --muted:#9a7c86;
      --line:rgba(243,154,178,.25);

      --brand:#f48fb1;
      --brand2:#f8bbd0;
      --warn:#ffb3a7;
      --danger:#ff7aa2;
      --ok:#8fcfb5;

      --shadow: 0 12px 30px rgba(244,143,177,.28);
      --radius: 22px;
      --radius2: 18px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Roboto, "Noto Sans KR",
                   "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% 0%, rgba(244,143,177,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(248,187,208,.20), transparent 55%),
        var(--bg);
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 10% 0%, rgba(122,162,255,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(155,255,214,.12), transparent 55%),
        radial-gradient(800px 500px at 50% 100%, rgba(255,204,102,.10), transparent 55%),
        var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:22px 18px 60px}
    .topbar{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(255,240,246,.92), rgba(255,240,246,.70));
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;gap:14px;align-items:center;justify-content:space-between}
    .brand{
      display:flex;gap:10px;align-items:center;
      font-weight:800;letter-spacing:.2px
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      padding:4px 10px;
      border:1px solid rgba(244,143,177,.25);
      border-radius:999px;
      background:#fff7fa;
    }
    nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .navbtn{
      font-size:13px;color:var(--muted);
      padding:8px 10px;border-radius:999px;
      border:1px solid transparent;
    }
    .navbtn:hover{color:var(--text);border-color:var(--line);background:#fff7fa}
    .hero{
      margin-top:18px;
      background: linear-gradient(135deg, #ffffff, #ffe9f1);
      border:1px solid rgba(244,143,177,.25);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding:26px 22px;
      display:grid;grid-template-columns: 1.2fr .8fr;gap:18px;
    }
    .hero h1{margin:0 0 8px;font-size:28px;line-height:1.15}
    .hero p{margin:0;color:var(--muted);line-height:1.55}
    .chips{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      font-size:12px;
      padding:7px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:#fff7fa;
      color:var(--muted)
    }
    .heroCard{
      border-radius: var(--radius2);
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      padding:14px 14px;
    }
    .kv{
      display:grid;gap:10px
    }
    .kvRow{
      display:flex;justify-content:space-between;gap:12px;
      padding:10px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.07);
      background:#fff7fa
    }
    .kvRow .k{color:var(--muted);font-size:12px}
    .kvRow .v{font-weight:700;font-size:13px}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      cursor:pointer;
      border:1px solid rgba(244,143,177,.35);
      background:#fff5f9;
      color:var(--text);
      padding:10px 12px;
      border-radius:16px;
      font-weight:700;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn:hover{filter:brightness(1.02)}
    .btn.primary{
      background: linear-gradient(135deg, #f8bbd0, #f48fb1);
      color:#ffffff;
      border:none;
      box-shadow: 0 6px 16px rgba(244,143,177,.35);
    }
    .grid{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:14px}
    section.card{
      border-radius: var(--radius);
      border:1px solid rgba(244,143,177,.25);
      background: linear-gradient(180deg, #ffffff, #fff3f8);
      box-shadow: var(--shadow);
      padding:18px 16px;
    }
    section.card h2{margin:0 0 10px;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin:0 0 14px;line-height:1.5}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:10px 0 12px}
    .pill{
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(244,143,177,.25);
      background:#fff3f8;
      user-select:none;
    }
    .pill.active{background: linear-gradient(135deg, #f8bbd0, #f48fb1); color:#ffffff; border:none}
    .input{
      width:100%;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(244,143,177,.25);
      background:#ffffff;
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    .list{display:grid;gap:10px}
    .item{
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      border-radius:18px;
      padding:12px 12px;
    }
    .itemTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .tag{
      font-size:11px;
      font-weight:800;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(244,143,177,.25);
      color:var(--muted);
      background:#fff0f6;
      white-space:nowrap;
    }
    .tag.important{background:#ffe4ec; color:#d94c7a; border-color:rgba(217,76,122,.25)}
    .tag.event{background:#fde2f0; color:#c94b78; border-color:rgba(201,75,120,.22)}
    .tag.ops{background:#ffeaf2; color:#b85a7c; border-color:rgba(184,90,124,.22)}
    .tag.tip{background:#e9fbf4; color:#4e8b73; border-color:rgba(78,139,115,.22)}
    .title{margin:0;font-weight:850;font-size:14px;line-height:1.35}
    .meta{margin-top:6px;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    details{border-top:1px dashed rgba(255,255,255,.10);margin-top:10px;padding-top:10px}
    details summary{cursor:pointer;color:var(--text);font-weight:800;font-size:13px;list-style:none}
    details summary::-webkit-details-marker{display:none}
    .content{color:var(--muted);font-size:13px;line-height:1.6;margin-top:10px}
    footer{
      margin-top:18px;color:var(--muted);font-size:12px;
      padding: 18px 10px 0;
      text-align:center;opacity:.9
    }
    .twoCol{
      display:grid;grid-template-columns:1fr 1fr;gap:10px
    }
    .miniCard{
      border:1px solid rgba(244,143,177,.18);
      background:#fffafb;
      border-radius:18px;
      padding:12px;
    }
    .miniCard h3{margin:0 0 6px;font-size:14px}
    .miniCard p{margin:0;color:var(--muted);font-size:13px;line-height:1.55}

/* ===== ëŸ¬ë¸”ë¦¬ ë§ˆë¬´ë¦¬ ===== */
section.card h2{
  display:flex;
  align-items:center;
  gap:6px;
  color:#d86b94;
}
.hero h1{color:#d86b94}
.emoji{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  filter:saturate(.75) brightness(1.08);
}

    .btn.ribbon{
      position:relative;
      padding-left:14px;
      padding-right:14px;
      border-radius:999px;
      box-shadow: 0 10px 22px rgba(244,143,177,.28);
    }
    .btn.ribbon::before,
    .btn.ribbon::after{
      content:"";
      position:absolute;
      top:50%;
      width:10px;height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.75);
      transform:translateY(-50%);
      filter:blur(.1px);
    }
    .btn.ribbon::before{left:10px}
    .btn.ribbon::after{right:10px}
    .btn.ribbon:hover{transform:translateY(-1px)}


    
    /* Mobile-safe wrapping for long text/URLs */
    .card p, .miniCard p, .content, .meta, .kvRow .v{
      overflow-wrap:anywhere;
      word-break:break-word;
    }
    a{
      overflow-wrap:anywhere;
      word-break:break-word;
    }


    @media (max-width: 900px){
      .hero{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      nav{justify-content:flex-start}
      .twoCol{grid-template-columns:1fr}

    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="inner">
      <div class="brand">
        <span style="display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:12px;border:1px solid var(--line);background:#fff7fa;font-weight:900;">ğŸ§­</span>
        <div>
          <div>ë°©ë‘ ê¸¸ë“œ</div>
          <div class="badge">Mabinogi Mobile Â· ë¼ì‚¬ ì„œë²„</div>
        </div>
      </div>
      <nav>
        <a class="navbtn" href="#home">í™ˆ</a>
        <a class="navbtn" href="#notice">ê³µì§€ì‚¬í•­</a>
        <a class="navbtn" href="#tips">ê²Œì„ê¿€íŒ</a>
        <a class="navbtn" href="#about">ê¸¸ë“œì†Œê°œ</a>
        <a class="navbtn" href="#join">ê¸¸ë“œì•ˆë‚´</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="home">
    <section class="hero">
      <div>
        <h1>ê°ìì˜ ì†ë„ë¡œ, ì˜¤ë˜ í•¨ê»˜ ê°€ëŠ” ê¸¸ë“œ <span style="color:var(--brand)">ë°©ë‘</span></h1>
        <p>
          ì†ë„ë³´ë‹¤ ì§€ì†, ê²½ìŸë³´ë‹¤ í˜¸í¡. <br/>
          ê³µì§€ì™€ ê¿€íŒì€ ì—¬ê¸°ì„œ í•œ ë²ˆì— í™•ì¸í•˜ê³ , ê²Œì„ì€ í¸í•˜ê²Œ ì¦ê²¨ìš”.
        </p>
        <div class="chips">
          <span class="chip">ì¹œëª© & í˜‘ë ¥</span>
          <span class="chip">ë¼ì´íŠ¸ ~ ì¤‘ê°„ í•˜ë“œ</span>
          <span class="chip">ì •ë³´ ê³µìœ </span>
          <span class="chip">ì„œë¡œ ì¡´ì¤‘</span>
        </div>

        <div class="ctaRow">
          <a class="btn primary" href="#notice"><span class="emoji">ğŸ“¢</span> ê³µì§€ ë³´ëŸ¬ê°€ê¸°</a>
          <a class="btn" href="#tips"><span class="emoji">ğŸ®</span> ê¿€íŒ ë³´ëŸ¬ê°€ê¸°</a>
        </div>
      </div>

      <div class="heroCard">
        <div class="kv">
          <div class="kvRow">
            <div class="k">ì„œë²„</div>
            <div class="v">ë¼ì‚¬</div>
          </div>
          <div class="kvRow">
            <div class="k">ë¶„ìœ„ê¸°</div>
            <div class="v">ìœ ì¾Œ + ë§¤ë„ˆ</div>
          </div>
          <div class="kvRow">
            <div class="k">ìš´ì˜</div>
            <div class="v">ì—´ë¦° ì˜ê²¬ ìˆ˜ìš©</div>
          </div>
          <div class="kvRow">
            <div class="k">ê°€ì… ë¬¸ì˜</div>
            <div class="v">ê¸¸ë§ˆ 'êµ°ë¦¼' ê·“</div>
          </div>
        </div>
        <div class="ctaRow">
          <button class="btn" id="copyInvite">ê¸¸ë“œ í™ë³´ ë¬¸êµ¬ ë³µì‚¬</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <!-- ê³µì§€ì‚¬í•­ -->
      <section class="card" id="notice">
        <h2><span class="emoji">ğŸ“¢</span> ê³µì§€ì‚¬í•­</h2>
        <p class="sub">ìš´ì˜/ì´ë²¤íŠ¸/ì¤‘ìš” ê³µì§€ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>

        <div class="toolbar" id="noticeFilters">
          <span class="pill active" data-filter="all">ì „ì²´</span>
          <span class="pill" data-filter="ops">ìš´ì˜</span>
          <span class="pill" data-filter="event">ì´ë²¤íŠ¸</span>
          <span class="pill" data-filter="important">ì¤‘ìš”</span>
        </div>

        <div class="list" id="noticeList"></div>
      </section>

      <!-- ê²Œì„ ê¿€íŒ -->
      <section class="card" id="tips">
        <h2><span class="emoji">ğŸ®</span> ê²Œì„ ê¿€íŒ</h2>
        <p class="sub">ê¸¸ë“œì›ë“¤ì´ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•œ íŒì„ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ëª¨ì•„ë†¨ì–´ìš”.</p>

        <div class="toolbar">
          <input class="input" id="tipSearch" placeholder="ê²€ìƒ‰: ì˜ˆ) íëŸ¬, ë£¬, ë˜ì „, ì´ë²¤íŠ¸, ì´ˆë³´â€¦" />
        </div>

        <div class="toolbar" id="tipFilters">
          <span class="pill active" data-filter="all">ì „ì²´</span>
          <span class="pill" data-filter="ìƒí™œ">ìƒí™œ</span>
          <span class="pill" data-filter="ë°ì½”">ë°ì½”</span>
          <span class="pill" data-filter="ìºë¦­í„°">ìºë¦­í„°</span>
          <span class="pill" data-filter="ë ˆì´ë“œ">ë ˆì´ë“œ</span>
          <span class="pill" data-filter="ì–´ë¹„ìŠ¤">ì–´ë¹„ìŠ¤</span>
        </div>

        <div class="list" id="tipList"></div>
      </section>
      <!-- ğŸ“· ì‚¬ì§„ ê²Œì‹œíŒ (ë…¸ì…˜ ì—°ë™) -->
      <section class="card" id="photos">
        <h2><span class="emoji">ğŸ“·</span> ì‚¬ì§„ ê²Œì‹œíŒ</h2>
        <p class="sub">ê¸¸ë“œì›ë“¤ì˜ ìŠ¤í¬ë¦°ìƒ·/ì¶”ì–µì„ ëª¨ì•„ë´ìš”. âœ¨ ìµœê·¼ ì‚¬ì§„ 6ì¥ ë¯¸ë¦¬ë³´ê¸°!</p>

        <div id="photoState" class="sub" style="margin-top:10px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        <div id="photoPreview" class="grid" style="margin-top:14px; display:none;"></div>

        <div class="row" style="justify-content:flex-end; margin-top:12px;">
          <a class="btn primary ribbon" href="/photos.html"><span class="emoji">ğŸ“·</span> ì‚¬ì§„ê²Œì‹œíŒ ë°”ë¡œê°€ê¸°</a>
        </div>
      </section>

    </div>

    <section class="card" id="about">
      <h2><span class="emoji">ğŸ§­</span> ê¸¸ë“œ ì†Œê°œ</h2>
      <p class="sub">ë°©ë‘ì€ â€œì˜¤ë˜ ì¦ê¸¸ ì‚¬ëŒë“¤â€ì„ ìœ„í•œ ê¸¸ë“œì˜ˆìš”. ë§ ê±¸ê¸° ì–´ë ¤ìš´ ë¶„ìœ„ê¸° NO.</p>

      <div class="twoCol">
        <div class="miniCard">
          <h3>ìš°ë¦¬ê°€ ì§€í‚¤ëŠ” ë¶„ìœ„ê¸°</h3>
          <p>
            Â· ì„œë¡œì˜ ì†ë„ ì¡´ì¤‘<br/>
            Â· ê³¼í•œ í›ˆìˆ˜/ë¹„ë‚œ ê¸ˆì§€<br/>
            Â· ì •ë³´ëŠ” ë‚˜ëˆŒìˆ˜ë¡ ê°•í•´ì§
          </p>
        </div>
        <div class="miniCard">
          <h3>ì˜ ë§ëŠ” ë¶„ / ì•ˆ ë§ëŠ” ë¶„</h3>
          <p>
            âœ” ë¼ì´íŠ¸í•˜ê²Œ ì˜¤ë˜ í•˜ê³  ì‹¶ì€ ë¶„<br/>
            âœ” ê°™ì´ ì›ƒê³  í˜‘ë ¥í•˜ëŠ” ê±¸ ì¢‹ì•„í•˜ëŠ” ë¶„<br/><br/>
            âŒ ê²½ìŸÂ·ìˆœìœ„ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í° ë¶„<br/>
            âŒ ë¹„ë§¤ë„ˆÂ·ë¶€ì ì ˆí•œ ì–¸í–‰ì„ í•˜ì‹œëŠ” ë¶„<br/>
          </p>
        </div>
      </div>
    </section>

    <section class="card" id="join">
      <h2><span class="emoji">ğŸ¤</span> ê¸¸ë“œ ì•ˆë‚´</h2>
      <p class="sub">ë°©ë‘ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì†Œê°œë“œë ¤ìš” ! </p>

      <div class="twoCol">
        <div class="miniCard">
          <h3>ê°„ë‹¨ ê·œì¹™</h3>
          <p>
            Â· ë§¤ë„ˆ/ê¸°ë³¸ ì˜ˆì˜ í•„ìˆ˜<br/>
            Â· ë‹¨í†¡(í•„ìˆ˜)/ë””ì½”(ììœ ) ì°¸ì—¬<br/>
            Â· ì‚¬ì „ ê³µìœ ì—†ì´ 5ì¼ ì´ìƒ ë¯¸ì ‘ ì‹œ ì¶”ë°©
          </p>
        </div>
        <div class="miniCard">
          <h3>ì†Œí†µ ë°©ë²•</h3>
          <p>
            Â· ì˜¤í”ˆì±„íŒ… : https://open.kakao.com/o/g5QEodph<br/>
            Â· ë””ìŠ¤ì½”ë“œ : https://discord.gg/3Ju6HZ99kJ<br/>
            Â· ìš´ì˜ì§„ : ê¸¸ë§ˆ 'êµ°ë¦¼' & ë¶€ê¸¸ë§ˆ 'ì§êµ¬' 'ì½©íŒ¥' 'ë„ˆí¬ì§‘ë§‰ë‚´'
          </p>
        </div>
      </div>
    </section>

    


    <footer>
  <div style="font-weight:600; color:#c86a8a; margin-bottom:4px;">
    ê°ìì˜ ì†ë„ë¡œ, ì˜¤ë˜ í•¨ê»˜ ğŸŒ¸
  </div>
  <div style="font-size:12px;">
    Â© ë°©ë‘ ê¸¸ë“œ Â· Mabinogi Mobile Lasa Server<br/>
    This is a fan-made guild page Â· with love ğŸ’•<br/>
    ì œì‘/ìˆ˜ì • ë„ì›€: ë„ˆí¬ì§‘ë§‰ë‚´ with ì•Œë ‰ìŠ¤
  </div>
</footer>
  </main>

  
  <!-- Supabase (ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- photos.htmlê³¼ ê°™ì€ ì„¤ì • íŒŒì¼ì„ ë£¨íŠ¸ì— ë‘ë©´ ì¸ë±ìŠ¤ì—ì„œë„ ê·¸ëŒ€ë¡œ ì”ë‹ˆë‹¤ -->
  <script src="/supabase_config.js"></script>

  <script>
  /* =========================
     âœ… ë°©ë‘ ê¸¸ë“œ ì¸ë±ìŠ¤
     - ê³µì§€/ê¿€íŒ: Notion DB â†’ Netlify Functionsë¡œ ê°€ì ¸ì™€ì„œ "ì œëª© í´ë¦­ ì‹œ í¼ì¹¨"
     - ì‚¬ì§„: Supabase ì‚¬ì§„ê²Œì‹œíŒì—ì„œ ìµœê·¼ 6ì¥ ë¯¸ë¦¬ë³´ê¸°
  ========================= */

  // ---------- utils ----------
  const $ = (id) => document.getElementById(id);

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  function toParagraphs(text){
    const safe = escapeHtml(text||"");
    return safe.split(/\n+/).map(p=>`<p style="margin:0 0 10px">${p}</p>`).join("") || "";
  }

  function safe(obj, path, fallback="") {
    try {
      return path.split(".").reduce((a,k)=> (a && a[k]!==undefined) ? a[k] : undefined, obj) ?? fallback;
    } catch(e){ return fallback; }
  }

  function mapPage(p){
    const props = p.properties || {};
    const title = (safe(props,"ì œëª©.title",[]) || []).map(x=>x.plain_text).join("") || "(ì œëª© ì—†ìŒ)";
    const date = safe(props,"ì‘ì„±ì¼.date.start") || safe(props,"Date.date.start") || "";
    const icon = p.icon && p.icon.type === "emoji" ? p.icon.emoji : "";
    // ì¹´í…Œê³ ë¦¬(Select) or multi_select ì²«ë²ˆì§¸ë¥¼ ëŒ€í‘œë¡œ ì‚¬ìš©
    const category = safe(props,"ì¹´í…Œê³ ë¦¬.select.name") || safe(props,"ì¹´í…Œê³ ë¦¬.multi_select.0.name") || "";
    const body =
      (safe(props,"ë‚´ìš©.rich_text",[]) || []).map(x=>x.plain_text).join("")
      || (safe(props,"ì„¤ëª….rich_text",[])||[]).map(x=>x.plain_text).join("")
      || "";
    // íƒœê·¸(ë‹¤ì¤‘ì„ íƒ)ë„ ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸° (ì„ íƒì‚¬í•­)
    const tags = (safe(props,"íƒœê·¸.multi_select",[]) || []).map(x=>x.name).filter(Boolean);
    return { title, date, icon, category, body, tags };
  }

  async function fetchList(type){
    const res = await fetch(`/.netlify/functions/notion?type=${type}`, { cache: "no-store" });
    const data = await res.json().catch(()=> ({}));
    if(!res.ok){
      console.warn("Notion fetch error", type, data);
      throw new Error(data?.message || "fetch failed");
    }
    return (data.results || []).map(mapPage);
  }

  // ---------- ê³µì§€: ì œëª©ë§Œ ë³´ì´ë‹¤ê°€ í¼ì¹¨ ----------
  async function renderNotices(){
    const el = $("noticeList");
    if(!el) return;

    el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;

    try{
      const list = await fetchList("notice");

      // ğŸ“Œ ê³ ì • ìš°ì„ , ìµœì‹ ìˆœ
      list.sort((a,b)=>{
        const ap = a.icon === "ğŸ“Œ" ? 1 : 0;
        const bp = b.icon === "ğŸ“Œ" ? 1 : 0;
        if(ap !== bp) return bp - ap;
        return (b.date || "").localeCompare(a.date || "");
      });

      if(list.length === 0){
        el.innerHTML = `<div class="item"><p class="sub" style="margin:0">í‘œì‹œí•  ê³µì§€ê°€ ì—†ì–´ìš”.</p></div>`;
        return;
      }

      // ìƒë‹¨ í•„í„°(ì „ì²´/ìš´ì˜/ì´ë²¤íŠ¸/ì¤‘ìš”) ë™ì‘: categoryê°€ ê·¸ ë‹¨ì–´ë¥¼ í¬í•¨í•˜ë©´ ë§¤ì¹­
      const currentFilter = $("noticeFilters")?.querySelector(".pill.active")?.dataset.filter || "all";
      const filtered = list.filter(item=>{
        if(currentFilter === "all") return true;
        const cat = (item.category || "").toLowerCase();
        if(currentFilter === "ops") return cat.includes("ìš´ì˜");
        if(currentFilter === "event") return cat.includes("ì´ë²¤íŠ¸");
        if(currentFilter === "important") return cat.includes("ì¤‘ìš”") || item.icon === "ğŸ“Œ";
        return true;
      });

      if(filtered.length === 0){
        el.innerHTML = `<div class="item"><p class="sub" style="margin:0">í•´ë‹¹ í•„í„°ì˜ ê³µì§€ê°€ ì—†ì–´ìš”.</p></div>`;
        return;
      }

      el.innerHTML = filtered.slice(0,20).map(item=>{
        const badgePin = item.icon==="ğŸ“Œ" ? `<span class="tag important">ğŸ“Œ ê³ ì •</span>` : "";
        const cat = item.category ? `<span class="tag">${escapeHtml(item.category)}</span>` : "";
        const meta = `
          <div class="meta">
            ${badgePin}${cat}
            ${item.date ? `<span>ğŸ“… ${escapeHtml(item.date)}</span>` : ``}
          </div>
        `;

        // âœ… ë§í¬ ì—†ìŒ: ì œëª© í´ë¦­ â†’ í¼ì¹¨
        return `
          <div class="item">
            <div class="itemTop">
              <div style="width:100%">
                <p class="title">${escapeHtml(item.title)}</p>
                ${meta}
              </div>
            </div>
            <details>
              <summary>ë‚´ìš© ë³´ê¸°</summary>
              <div class="content">${toParagraphs(item.body)}</div>
            </details>
          </div>
        `;
      }).join("");
    }catch(e){
      el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ê³µì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(e.message || String(e))}</p></div>`;
    }
  }

  // ---------- ê¿€íŒ: Notion ì¹´í…Œê³ ë¦¬(ìƒí™œ/ë°ì½”/ìºë¦­í„°/ë ˆì´ë“œ/ì–´ë¹„ìŠ¤) ìë™ ë°˜ì˜ + í¼ì¹¨ ----------
  let TIP_ALL = [];
  let tipState = { filter:"all", q:"" };

  function renderTipList(){
    const el = $("tipList");
    if(!el) return;

    const qq = (tipState.q||"").trim().toLowerCase();
    const data = TIP_ALL.filter(item=>{
      const okFilter = (tipState.filter==="all") ? true : item.category === tipState.filter;
      if(!okFilter) return false;
      if(!qq) return true;
      const hay = (item.title + " " + (item.category||"") + " " + (item.tags||[]).join(" ") + " " + (item.body||"")).toLowerCase();
      return hay.includes(qq);
    });

    if(data.length === 0){
      el.innerHTML = `<div class="item"><p class="sub" style="margin:0">í•´ë‹¹ ì¡°ê±´ì˜ ê¿€íŒì´ ì—†ì–´ìš”.</p></div>`;
      return;
    }

    el.innerHTML = data.slice(0,40).map(item=>{
      const cat = item.category ? `<span class="tag tip">${escapeHtml(item.category)}</span>` : `<span class="tag tip">ê¿€íŒ</span>`;
      const chips = (item.tags||[]).slice(0,4).map(t=>`<span class="chip" style="padding:4px 8px">${escapeHtml(t)}</span>`).join("");
      return `
        <div class="item">
          <div class="itemTop">
            <div style="width:100%">
              <p class="title">${escapeHtml(item.title)}</p>
              <div class="meta" style="margin-top:8px">
                ${cat}
                ${item.date ? `<span>ğŸ“… ${escapeHtml(item.date)}</span>` : ``}
                ${chips}
              </div>
            </div>
          </div>
          <details>
            <summary>ë‚´ìš© ë³´ê¸°</summary>
            <div class="content">${toParagraphs(item.body)}</div>
          </details>
        </div>
      `;
    }).join("");
  }

  function syncTipFilterUIFromNotion(){
    // Notionì—ì„œ ì‹¤ì œë¡œ ì“°ëŠ” ì¹´í…Œê³ ë¦¬ê°€ ë°”ë€Œì–´ë„ ìë™ ë°˜ì˜ ê°€ëŠ¥
    const filterBar = $("tipFilters");
    if(!filterBar) return;

    const desiredOrder = ["ìƒí™œ","ë°ì½”","ìºë¦­í„°","ë ˆì´ë“œ","ì–´ë¹„ìŠ¤"];
    const have = new Set(TIP_ALL.map(x=>x.category).filter(Boolean));

    // ë²„íŠ¼ í…ìŠ¤íŠ¸ëŠ” ìœ ì§€í•˜ë˜, Notionì— ì—†ëŠ” ì¹´í…Œê³ ë¦¬ëŠ” ë¹„í™œì„±/ìˆ¨ê¹€ ì²˜ë¦¬
    [...filterBar.querySelectorAll(".pill")].forEach(p=>{
      const f = p.dataset.filter;
      if(f === "all") return;
      if(!have.has(f)){
        p.style.display = "none";
      }else{
        p.style.display = "inline-flex";
      }
    });

    // í˜¹ì‹œ Notionì—ì„œ ìƒˆ ì¹´í…Œê³ ë¦¬ê°€ ìƒê²¼ëŠ”ë°(ì˜ˆ: "PVP") UIì— ì—†ìœ¼ë©´ ìë™ ì¶”ê°€
    const existing = new Set([...filterBar.querySelectorAll(".pill")].map(p=>p.dataset.filter));
    const extras = [...have].filter(x=> x !== "all" && !existing.has(x));

    if(extras.length){
      // extrasëŠ” ëì— ë¶™ì´ê³ , ë””ìì¸ ë™ì¼
      extras.forEach(x=>{
        const span = document.createElement("span");
        span.className = "pill";
        span.dataset.filter = x;
        span.textContent = x;
        filterBar.appendChild(span);
      });
    }

    // ì›í•˜ëŠ” ìˆœì„œëŒ€ë¡œ DOM ì •ë ¬(ì „ì²´ëŠ” ë§¨ ì•)
    const pills = [...filterBar.querySelectorAll(".pill")];
    const map = new Map(pills.map(p=>[p.dataset.filter, p]));
    filterBar.innerHTML = "";
    filterBar.appendChild(map.get("all"));
    desiredOrder.forEach(k=>{ if(map.get(k)) filterBar.appendChild(map.get(k)); });
    // ë‚˜ë¨¸ì§€(ì¶”ê°€ëœ ì¹´í…Œê³ ë¦¬)
    pills.forEach(p=>{
      const k = p.dataset.filter;
      if(k==="all") return;
      if(desiredOrder.includes(k)) return;
      if(!filterBar.contains(p)) filterBar.appendChild(p);
    });
  }

  async function renderTips(){
    const el = $("tipList");
    if(!el) return;

    el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;

    try{
      const list = await fetchList("tips");
      list.sort((a,b)=> (b.date||"").localeCompare(a.date||""));
      TIP_ALL = list;

      syncTipFilterUIFromNotion();
      renderTipList();
    }catch(e){
      el.innerHTML = `<div class="item"><p class="sub" style="margin:0">ê¿€íŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${escapeHtml(e.message || String(e))}</p></div>`;
    }
  }

  // ---------- ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°: Supabase ì‚¬ì§„ê²Œì‹œíŒì—ì„œ ìµœê·¼ 6ì¥ ----------
  async function renderPhotoPreview(){
    const stateEl = $("photoState");
    const gridEl  = $("photoPreview");
    if(!stateEl || !gridEl) return;

    // supabase_config.js ëˆ„ë½ ì‹œ
    if(!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY || !window.supabase){
      stateEl.textContent = "ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì„¤ì •ì´ ì•„ì§ ì—†ì–´ìš”. (supabase_config.js í™•ì¸)";
      gridEl.style.display = "none";
      return;
    }

    const sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    const BUCKET = "bangrang-photos";
    const TABLE  = "photo_posts";

    stateEl.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
    gridEl.style.display = "none";

    const { data, error } = await sb
      .from(TABLE)
      .select("id, image_path, caption, nickname, created_at, taken_on")
      .order("created_at", { ascending:false })
      .limit(6);

    if(error){
      stateEl.textContent = "ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: " + error.message;
      gridEl.style.display = "none";
      return;
    }

    if(!data || data.length === 0){
      stateEl.textContent = "ì•„ì§ ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ì–´ìš”. ì²« ì—…ë¡œë“œ í•´ì¤˜ìš” ğŸ’–";
      gridEl.style.display = "none";
      return;
    }

    stateEl.style.display = "none";
    gridEl.style.display = "grid";
    gridEl.innerHTML = data.map(row=>{
      const { data: pub } = sb.storage.from(BUCKET).getPublicUrl(row.image_path);
      const imgUrl = pub.publicUrl;
      const title = escapeHtml(row.caption || "ì‚¬ì§„");
      const who = escapeHtml(row.nickname || "ìµëª…");
      return `
        <a class="miniCard" href="/photos.html" style="padding:10px; border-radius:18px; overflow:hidden;">
          <div style="width:100%; aspect-ratio:1/1; border-radius:14px; overflow:hidden; border:1px solid rgba(244,143,177,.18); background:#fff7fa;">
            <img src="${imgUrl}" alt="${title}" style="width:100%; height:100%; object-fit:cover; display:block;">
          </div>
          <div style="margin-top:8px; font-weight:800; font-size:13px; line-height:1.25; color:var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${title}</div>
          <div style="margin-top:4px; font-size:12px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">ğŸ‘¤ ${who}</div>
        </a>
      `;
    }).join("");
  }

  // ---------- UI events ----------
  // ê³µì§€ í•„í„° í´ë¦­ â†’ ë‹¤ì‹œ ë Œë”
  const noticeFilters = $("noticeFilters");
  if(noticeFilters){
    noticeFilters.addEventListener("click", (e)=>{
      const pill = e.target.closest(".pill");
      if(!pill) return;
      [...noticeFilters.querySelectorAll(".pill")].forEach(p=>p.classList.remove("active"));
      pill.classList.add("active");
      renderNotices();
    });
  }

  // ê¿€íŒ í•„í„° í´ë¦­ â†’ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•„í„°ë§
  const tipFilters = $("tipFilters");
  if(tipFilters){
    tipFilters.addEventListener("click", (e)=>{
      const pill = e.target.closest(".pill");
      if(!pill) return;
      [...tipFilters.querySelectorAll(".pill")].forEach(p=>p.classList.remove("active"));
      pill.classList.add("active");
      tipState.filter = pill.dataset.filter;
      renderTipList();
    });
  }

  const tipSearch = $("tipSearch");
  if(tipSearch){
    tipSearch.addEventListener("input", ()=>{
      tipState.q = tipSearch.value;
      renderTipList();
    });
  }

  // ì´ˆëŒ€ ë¬¸êµ¬ ë³µì‚¬ ë²„íŠ¼(ê¸°ì¡´ ìœ ì§€)
  const copyBtn = $("copyInvite");
  if(copyBtn){
    copyBtn.addEventListener("click", async ()=>{
      const text =
`[ë§ˆë¹„ë…¸ê¸° ëª¨ë°”ì¼] ë¼ì‚¬ ì„œë²„ 'ë°©ë‘' ê¸¸ë“œì—ì„œ í•¨ê»˜í•˜ì‹¤ ë¶„ì„ ì°¾ì•„ìš”!
- ë¼ì´íŠ¸~ì¤‘ê°„ í•˜ë“œ / ì¹œëª©&í˜‘ë ¥
- ë¬¸ì˜: ê¸¸ë§ˆ 'êµ°ë¦¼' ê·“`;
      try{
        await navigator.clipboard.writeText(text);
        alert("ì´ˆëŒ€ ë¬¸êµ¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”!");
      }catch(err){
        prompt("ë³µì‚¬ ê¶Œí•œì´ ì—†ì–´ì„œ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”:", text);
      }
    });
  }

  // ---------- start ----------
  renderNotices();
  renderTips();
  renderPhotoPreview();
  </script>

</body>
</html>